<!DOCTYPE html>
<html>
	<head>

		<title> Etch A Sketch </title>
		<meta charset="utf-8">
	</head>

	<body>

		<style>

			div {
				-webkit-user-select: none;
				-moz-user-seleect: none;
				user-select: none;
				position: relative;
				display:block;
				margin: auto;
				top:20%;
				width: 100%;
				max-width: 750px;
				text-align: center;
				
			}
			#frame {
				position: relative;
				display: block;
				margin: auto;
				width: 99%;
				z-index: -9999;
			}

			#screen {
				position: absolute;
				margin: auto;
				left: 10%;
				top: 14%;
				width: 80%;
			}

			#canvasContainer {
				position: absolute;
				display: block;
				margin: auto;
				left: 10.8%;
				top: 14.8%;
				height: 68%;
				width: 78%;
				/*border: 1px solid black;*/

			}
		</style>

		<div>
			<img id="frame" src="etch-a-sketch.png">
			<img id="screen" src="screen.png">
			<div id ="canvasContainer"></div>
			<p>etch a sketch made by jen</p>
		</div>
		
		<script src="p5.js"></script>
		<script src="WebMIDIAPI.min.js"></script>

		<script>

			var myScreen = document.getElementById("screen");
			var screenWidth = myScreen.width;
			var screenHeight = myScreen.height;

			var canvasWidth = screenWidth-(screenWidth*.021667)
			var canvasHeight = screenHeight-(screenHeight*.026020)



			function setup(){
				var canvas = createCanvas(canvasWidth,canvasHeight);
				canvas.parent("canvasContainer");

			}


			// request MIDI access
			if (navigator.requestMIDIAccess) {
			    navigator.requestMIDIAccess({
			        sysex: false // this defaults to 'false' and we won't be covering sysex in this article. 
			    }).then(onMIDISuccess, onMIDIFailure);
			} else {
			    alert("No MIDI support in your browser.");
			}

			var midiX = 0;
			var midiY = 0;
			var pixelX = 0;
			var pixelY = 0;

			// midi functions
			function onMIDISuccess(midiAccess) {
			    // when we get a succesful response, run this code
				// console.log('MIDI Access Object', midiAccess);

				var midi = midiAccess;
				var inputs = midi.inputs.values();
				for ( var input = inputs.next(); input && !input.done; input = inputs.next() ) {
					input.value.onmidimessage = onMIDIMessage;
				}

				var outputs = midi.outputs.forEach(function(key,port){
					} 
				);

				console.log(outputs;
			}

			function onMIDIMessage(message){

				if(message.data[1] == 16){
					midiX = message.data[2];
					pixelX = midiX*(canvasWidth/127);
				}

				if(message.data[1] == 23){
					midiY = Math.abs( message.data[2] - 127 );
					pixelY = midiY*(canvasHeight/127);
 				}

 				console.log(midiX, midiY);
			}

			var sX = canvasWidth/127;
			var sY = canvasHeight/127;


			function myPixel(){
				fill("#000000");
				rect(pixelX,pixelY, sX, sX);
			}


			function draw(){	

				if(pixelX >= canvasWidth-sX){
					pixelX = canvasWidth-1.5*sX;
				}
				if (pixelY >= canvasHeight-sY){
					pixelY = canvasHeight-2*sY;
				}

					myPixel();
			}



			function onMIDIFailure(e) {
			    // when we get a failed response, run this code
			    alert("only works on chrome sry !!! :'(");
			}

		</script>



	</body>
</html>